SET SQL_MODE='ALLOW_INVALID_DATES';
CREATE DATABASE flights_platform;
USE flights_platform;
CREATE TABLE users (
	userID INT NOT NULL AUTO_INCREMENT,
    phone VARCHAR(30) NOT NULL,
    email VARCHAR(60) NOT NULL,
    birthDate TIMESTAMP,
    passw VARCHAR(20) NOT NULL,
    createdAt TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (userID)
);

CREATE TABLE passengers (
	passengerID INT NOT NULL AUTO_INCREMENT,
	userID INT,
	fName VARCHAR(50) NOT NULL,
    	lName VARCHAR(50) NOT NULL,
	birthDate TIMESTAMP NOT NULL,
	PRIMARY KEY (passengerID),
	FOREIGN KEY (userID) REFERENCES users(userID) ON DELETE CASCADE
);


CREATE TABLE admins (
	adminID INT NOT NULL AUTO_INCREMENT,
    privilege VARCHAR(20) NOT NULL,
    fName VARCHAR(50) NOT NULL,
    lName VARCHAR(50) NOT NULL,
    phone VARCHAR(30) NOT NULL,
    email VARCHAR(60) NOT NULL,
    birthDate TIMESTAMP,
    passw VARCHAR(20) NOT NULL,
    createdAt TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (adminID)
);

CREATE TABLE planes (
	planeID INT NOT NULL AUTO_INCREMENT,
   	 model VARCHAR(50),
    	seats INT NOT NULL,
    	PRIMARY KEY(planeID)
);

CREATE TABLE airports(
	airportID INT NOT NULL AUTO_INCREMENT,
	airportAdress VARCHAR(100) NOT NULL,
	PRIMARY KEY (airportID)
);

CREATE TABLE vols (
	volID INT NOT NULL AUTO_INCREMENT,
    planeID INT,
    departureDate TIMESTAMP NOT NULL,
    arrivalDate TIMESTAMP NOT NULL,
    availableSeats INT NOT NULL,
    price FLOAT,
    createdAt TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    state VARCHAR(20),
    PRIMARY KEY (volID),
    FOREIGN KEY (planeID) REFERENCES planes(planeID)
);

CREATE TABLE departures(
	volID INT,
	airportID INT,
	FOREIGN KEY (volID) REFERENCES vols(volID) ON DELETE CASCADE,
	FOREIGN KEY (airportID) REFERENCES airports(airportID)
);

CREATE TABLE destinations(
	volID INT,
	airportID INT,
	FOREIGN KEY (volID) REFERENCES vols(volID) ON DELETE CASCADE,
	FOREIGN KEY (airportID) REFERENCES airports(airportID)
);

CREATE TABLE reservs (
    reservID INT NOT NULL AUTO_INCREMENT,
    volID INT,
    passengerID INT,
    dateReserv TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP, 
    goingComing VARCHAR(20) NOT NULL DEFAULT 'Going',
    seatNum INT,
    PRIMARY KEY (reservID),
    FOREIGN KEY (volID) REFERENCES vols(volID) ON DELETE CASCADE,
    FOREIGN KEY (passengerID) REFERENCES passengers(passengerID) ON DELETE CASCADE
);
